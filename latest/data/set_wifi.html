<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=windows-1252" http-equiv="content-type">
    <title>SSLAC16</title>
  </head>
  <body style=" background-color: #00bebe;">
    <h1>
      <div id="_hostname"></div>
    </h1>
    <h5>
      <div id="ver"></div>
    </h5>
    <h3>Wi-Fi Setup</h3>
    <form action="/" method="get"><input value="&lt;-Back" type="submit"> <button
        formmethod="get" formaction="/cur_ch.html" type="submit">View Channels
        status</button> </form>
    <br>
    <form> <br>
      <div id="info"></div>
      <br>
      You can give your own hostname <input id="hostname" type="text"> <input
        value="Set" onclick="set()" type="button"><br>
      WiFi network will be renamed after that<br>
      Hide own WiFi network password<input id="isHidePassword" onchange="_isHidePassword()" type="checkbox"><br>
    
    </form>
    <br>
    <input value="Scan WiFi" onclick="scan()" type="button">
    <div id="table"></div>
    <br>
    <form> <input value="Save" onclick="sv()" type="button"> <button formmethod="get"
        \="" formaction="/set_time.html" type="submit">Time SetUp</button> <button
        formmethod="get" \="" formaction="/set_i2c.html" type="submit">I2C SetUp</button>
      <button formmethod="get" \="" formaction="/set_ch.html" type="submit">Channels
        Value</button> <button formmethod="get" \="" formaction="/set_sched.html"
        type="submit">Channels Schedule</button> <input value="Reboot" onclick="sr()"
        type="button"> </form>
    <script src="sslac.js">  </script>
    <script>
      document.getElementById('ver').innerHTML = get_version();
     get_info();
     var info; 
     
     function set(){
          set_rest('hostname='+document.getElementById('hostname').value);
     } 
      
      function get_info(){
        var _body;
                 _arr=get_rest('info');;
                 if (_arr[1][9]==1) 
                    _body='You are already connected to the "'+_arr[1][11]+'" network<br>\
                      IP Address is '+_arr[1][10]+'<br>';
                    else _body='You are not connected to any wi-fi network<br>';
                 document.getElementById('info').innerHTML = _body;
                 if (_arr[1][17]==1) document.getElementById('_hostname').innerHTML = _arr[1][15]+'(Slave)';
                 if (_arr[1][16]==1) document.getElementById('_hostname').innerHTML = _arr[1][15]+'(Master)';
                 if ((_arr[1][16]==0) & (_arr[1][17]==0)) document.getElementById('_hostname').innerHTML = _arr[1][15];
                 document.getElementById('hostname').value = _arr[1][15];
                 if (_arr[6][4]==1) document.getElementById("isHidePassword").checked=true; 
                    else
                      document.getElementById("isHidePassword").checked=false;
      }
      
      function scan(){
        alert("Please wait when scan finished");
        scan_wifi();
        gen_table(arr);
      }
      
      function scan_wifi(){
              _ssid=get_rest('ssid');
              arr=get_rest('wifi');
      }
      var _url='';
      var arr;
      var wifi;
      var _ssid;
      function gen_table(n){
        if (n==-1) scan_wifi();
          var body='<form><table style="width: 512px" border="1">\
      <tbody>\
        <tr>\
          <td>Select</td>\
          <td>#</td>\
          <td>SSID</td>\
          <td>Signal</td>\
          <td>Channel</td>\
        </tr>';
        if (n!=arr) n=arr;
        for (i=0;i<n;i++){
                wifi=get_rest('wifi='+i);
          body+='<tr>';
          if (_ssid!=wifi[0]) body+='<td><button onclick="connect(\''+i+'\')">Connect</button></td>';
          else body+='<td>Connected</td>';
          body+='<td>'+i+'</td>';
          body+='<td><input type="text" readonly="readonly" value="'+wifi[0]+'" id="ssid'+i+'"></td>';
          body+='<td>'+wifi[2]+'db</td>';
          body+='<td>'+wifi[4]+'</td>';
          body+='</tr>';
        }
        body+='</tbody></table></from>\
        ';
        
          document.getElementById('table').innerHTML = body;
      }
      
  function connect(n){
    var ssid=document.getElementById('ssid'+n).value;
    var passwd = prompt("Please enter password for "+ssid+" network");
    set_rest('ssid='+ssid+'&passwd='+passwd);
  }

    function _isHidePassword(){
      
      
      if(document.getElementById("isHidePassword").checked) {
        alert("Dont froget you default password !!!");
        set_rest("isHidePassword=1");
      } else set_rest("isHidePassword=0");
      
        
      
    

  }
</script>
  </body>
</html>
