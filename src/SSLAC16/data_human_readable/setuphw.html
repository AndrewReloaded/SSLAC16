<!DOCTYPE html>
<html>

<head>
    <title>SlSLAC setup HW</title>
</head>

<body bgcolor=#00BEBE>
    <table style=width:800px border=1>
        <caption> NetWork, Time and HardWare Setup </caption>
        <tbody>
            <tr>
                <td style=width:50%>
                    <table style=width:100% border=0>
                        <caption>
                            <button onclick=fPC()>Sync local PC</button> Time setup
                            <button onclick=ntp()>Sync NTP server</button>
                        </caption>
                        <tbody>
                            <tr>
                                <td>TimeZone UTC </td>
                                <td>
                                    <input step=0.5 max=12 min=-12 id=tz onchange="set_save_time('1')" type=number>
                                </td>
                            </tr>
                            <tr>
                                <td>Current Time </td>
                                <td>
                                    <div id=curTime>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>
                <td style=width:50%>
                    <table style=width:100% border=0>
                        <caption>I2C setup</caption>
                        <tbody>
                            <tr>
                                <td>SDA GPIO</td>
                                <td>
                                    <input step=1 max=16 min=1 id=pSDA oninput="set_val('pSDA')" type=number>
                                </td>
                            </tr>
                            <tr>
                                <td>SCL GPIO </td>
                                <td>
                                    <input step=1 max=16 min=1 id=pSCL oninput="set_val('pSCL')" type=number>
                                </td>
                            </tr>
                            <tr>
                                <td>PWM freq(Hz) </td>
                                <td>
                                    <input step=10 max=1500 min=40 id=pwmFreq oninput="set_val('pwmFreq')" type=number>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
        </tbody>
    </table>
    <table style=width:800px border=1>
        <tbody>
            <tr>
                <td style=width:50%>
                    <table style=width:100% border=0>
                        <caption>WiFi setup:
                            <input value="Scan WiFi" onclick=scan() type=button>
                        </caption>
                        <tbody>
                            <tr>
                                <td>Hostname
                                    <br>IP address: </td>
                                <td>
                                    <div id=hostname></div>
                                    <div id=ipaddr></div>
                                </td>
                            </tr>
                            <tr>
                                <td>Connected to: </td>
                                <td>
                                    <div id=ssid>
                                        <td>
                                            <button id=discon onclick=disconnect()>Disconnect </td>
                            </tr>
                            <tr>
                                <td>network list </td>
                                <td>
                                    <select id=wifi></select>
                                    <td>
                                        <button onclick=connect()>Connect </tr>
                            <tr>
                                <td style=width:100%>Hide own WiFi password
                                    <td>
                                        <input id=isHidePassword onchange=_isHidePassword() type=checkbox>
                                    </td>
                        </tbody>
                    </table>
                    <td>
                        <table border="0" style="width: 100%">
                            <caption>DS18x20 setup:
                                <input value="Scan Sensors" onclick=scan_sens() type=button>
                                <input value="Clear all Sensors" onclick=clear_sens() type=button>
                            </caption>
                            <tbody>
                                <tr>
                                    <td># </td>
                                    <td>Sensor name: </td>
                                    <td>Sensor temperature: </tr>
                                <tr>
                                    <td>
                                        <div id=index0>
                                            <td>
                                                <div id=sname0>
                                                    <td>
                                                        <div id=stemp0>
                                </tr>
                                <tr>
                                    <td>
                                        <div id=index1>
                                            <td>
                                                <div id=sname1>
                                                    <td>
                                                        <div id=stemp1>
                                </tr>
                                <tr>
                                    <td>
                                        <div id=index2>
                                            <td>
                                                <div id=sname2>
                                                    <td>
                                                        <div id=stemp2>
                                </tr>
                                <tr>
                                    <td>
                                        <div id=index3>
                                            <td>
                                                <div id=sname3>
                                                    <td>
                                                        <div id=stemp3>
                                </tr>
                                <tr>
                                    <td>
                                        <div id=index4>
                                            <td>
                                                <div id=sname4>
                                                    <td>
                                                        <div id=stemp4>
                                </tr>
                                <tr>
                                    <td>
                                        <div id=index5>
                                            <td>
                                                <div id=sname5>
                                                    <td>
                                                        <div id=stemp5>
                                </tr>
                                <tr>
                                    <td>
                                        <div id=index6>
                                            <td>
                                                <div id=sname6>
                                                    <td>
                                                        <div id=stemp6>
                                </tr>
                                <tr>
                                    <td>
                                        <div id=index7>
                                            <td>
                                                <div id=sname7>
                                                    <td>
                                                        <div id=stemp7>
                                </tr>
                            </tbody>
                        </table>
        </tbody>
    </table>
    <table style=width:800px border=1>
        <caption>Files update</captio>
            <tbody>
                <tr>
                    <td>
                        <table>
                            <caption> Online Update
                                <tbody>
                                    <tr border=1>
                                        <td>
                                            <input disabled value="HTML/JS update" onclick="uHTML('pHTML')" style=width:120px;height:20px type=button>
                                            <progress id=pHTML value=0 max=100></progress>
                                            <br>
                                            <input disabled value="FirmWare update" onclick="uFirmWare('pFirmWare')" style=width:120px;height:20px type=button>
                                            <progress id=pFirmWare value=0 max=100></progress>
                                            <br>
                                        </td>
                                    </tr>
                                </tbody>
                        </table>
                        <td>
                            <table>
                                <caption>Offline</caption>
                                <tbody>
                                    <tr>
                                        <td>
                                            <form id=fileUpload method=POST action=/upload enctype=multipart/form-data>
                                                <input name=myfile1 size=20 lang=en type=file>
                                                <input value=Upload type=submit>
                                            </form>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                </tr>
            </tbody>
    </table>
    <form>
        <input value=Save onclick=sv() type=button>
        <input type=button onClick=home() value='Daily Schedule'>
        <input type=button onClick="location.href='1SetUp.html'" value='Channels&Group setup'>
        <input type=button onClick="location.href='EmLight.html'" value='Emergency light setup'>
        <input type=button onClick="location.href='Fan.html'" value='Fan/Temperature setup'>
        <input type=button onClick="location.href='setuphw.html'" value=Setup&Upgrade disabled>
        <input value=Reboot \ onclick=sr() type=button>
    </form>
</body>

</html>
<script src=sslac.js></script>
<script>
    set_rest("EmLight=0", _ip);
    var info1, info;
    var foundedNet = [];
    var Sensors = [];
    info = get_rest("info=", _ip);
    document.getElementById("hostname").innerHTML = "<input id='_host'type='text' value=" + info[1][15] + " onchange=set_hn(this) > ";
    setInterval(getInfo1, 1000);

    function getInfo1() {
        info1 = get_rest("info=1", _ip);
        document.getElementById("pSDA").value = info1[1][0];
        document.getElementById("pSCL").value = info1[1][1];
        document.getElementById("pwmFreq").value = info1[1][2];
        if (info1[2][5] == 0) {
            document.getElementById("ipaddr").innerHTML = info1[2][3];
            document.getElementById("ssid").innerHTML = "Not connected";
            document.getElementById("discon").disabled = true
        } else {
            document.getElementById("ipaddr").innerHTML = info1[2][3];
            document.getElementById("ssid").innerHTML = info1[2][2];
            document.getElementById("discon").disabled = false
        }
        var a = "";
        if (info1[0][0] < 10) {
            a = "0" + info1[0][0] + ":"
        } else {
            a = info1[0][0] + ":"
        }
        if (info1[0][1] < 10) {
            a += "0" + info1[0][1] + ":"
        } else {
            a += info1[0][1] + ":"
        }
        if (info1[0][2] < 10) {
            a += "0" + info1[0][2]
        } else {
            a += info1[0][2]
        }
        document.getElementById("curTime").innerHTML = a;
        document.getElementById("tz").value = (info1[0][3] - 127) / 10;
        var b = document.getElementById("fileUpload");
        if (b.action == "file:///upload") {
            b.action = "http://" + _ip + "/upload"
        }
        if (info[6][4] == 1) {
            document.getElementById("isHidePassword").checked = true
        }
    }
    getInfo1();
    getNet();
    setSensor();

    function setSensor() {
        for (i = 0; i < info1[3][0]; i++) {
            Sensors[i] = get_rest("temp=" + i, _ip);
            document.getElementById("index" + i).innerHTML = Sensors[i][8];
            document.getElementById("stemp" + i).innerHTML = Sensors[i][9] / 1000;
            document.getElementById("sname" + i).innerHTML = "<input id='_name" + i + "' onchange=\"sensorName(this)\" type='text' value=" + Sensors[i][10] + "> "
        }
    }

    function sensorName(a) {
        set_rest("temp=" + a.id.substring(5) + "&=" + a.value, _ip)
    }

    function fillNet() {
        var a = document.getElementById("wifi");
        while (a.length != 0) {
            a.remove(a.lengt)
        }
        for (i = 0; i < foundedNet.length; i++) {
            var b = document.createElement("option");
            b.text = foundedNet[i];
            b.value = [i];
            a.add(b)
        }
    }

    function connect() {
        var b = foundedNet[document.getElementById("wifi").value];
        var a = prompt("Please enter password for " + b + " network");
        post_rest("ssid=" + b + "&passwd=" + a, _ip);
        getInfo1();
        getNet()
    }

    function scan() {
        alert("Please wait when scan finished");
        scan_wifi()
    }

    function scan_wifi() {
        info1[2][4] = get_rest("wifi=", _ip);
        getNet()
    }

    function getNet() {
        for (i = 0; i < info1[2][4]; i++) {
            foundedNet[i] = get_rest("wifi=" + i, _ip)[0]
        }
        foundedNet = array_unique(foundedNet);
        fillNet()
    }

    function disconnect() {
        get_rest("wifi=disconnect", _ip);
        getInfo1();
        getNet()
    }

    function fPC() {
        var a = new Date();
        set_rest("time=&h=" + a.getHours() + "&m=" + a.getMinutes() + "&s=" + (a.getSeconds() + 1), _ip)
    }

    function ntp() {
        set_rest("time=ntp", _ip)
    }

    function set_save_time(a) {
        val = parseFloat(document.getElementById("tz").value);
        tz = val;
        val = val * 10 + 127;
        set_rest("&time=&tz=" + val, _ip)
    }

    function _isHidePassword() {
        if (document.getElementById("isHidePassword").checked) {
            alert("Dont froget you default password !!!");
            set_rest("isHidePassword=1", _ip);
            info[6][4] = 1
        } else {
            set_rest("isHidePassword=0", _ip);
            info[6][4] = 0
        }
    }

    function scan_sens() {
        set_rest("1wire=rescan", _ip)
    }

    function clear_sens() {
        set_rest("1wire=clear", _ip)
    }

    function set_val(a) {
        var b = document.getElementById(a).value;
        set_rest(a + "=" + b, _ip)
    }

    function array_unique(b) {
        var a = [];
        for (var c = 0; c < b.length; c++) {
            if (a.indexOf(b[c]) == -1) {
                a.push(b[c])
            }
        }
        return a
    }

    function set_hn(a) {
        set_rest("hostname=" + a.value)
    };
</script>